<% layout = "layout" %>
<div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; margin-bottom: 20px;">
        <h2>Painel Administrativo</h2>
        <p>Logado como: <b><%= user.username %></b> (<a href="/auth/logout">Sair</a>)</p>
    </div>

    <% if (errorMessage) { %>
        <div style="margin-bottom: 30px; padding: 15px; background: #ffcdd2; border: 1px solid #e57373; border-radius: 4px; color: #c62828; font-weight: bold;">
            ‚ùå Erro: <%= decodeURIComponent(errorMessage) %>
        </div>
    <% } %>

    <% if (successMessage) { %>
        <div style="margin-bottom: 30px; padding: 15px; background: #c8e6c9; border: 1px solid #81c784; border-radius: 4px; color: #2e7d32; font-weight: bold;">
            ‚úÖ Sucesso: <%= decodeURIComponent(successMessage) %>
        </div>
    <% } %>

    <div style="margin-bottom: 30px; padding: 15px; background: #e0f7fa; border: 1px solid #b2ebf2; border-radius: 4px;">
        ‚úÖ **Gerenciar Usu√°rios e Aprova√ß√µes:** <a href="/admin/users" style="font-weight: bold; color: #00838f;">Ver Lista Completa de Usu√°rios</a>
    </div>

    <div style="margin-bottom: 30px; padding: 15px; background: #fff3e0; border: 1px solid #ffcc80; border-radius: 4px;">
        üí¨ **Gerenciar Feedback e Coment√°rios:** <a href="/admin/feedback" style="font-weight: bold; color: #ef6c00;">Responder Coment√°rios Pendentes</a>
    </div>
    
    <div style="margin-bottom: 30px; padding: 15px; background: #e8f5e9; border: 1px solid #a5d6a7; border-radius: 4px;">
        üì¢ <b>Mensagens Globais:</b>
        <a href="/admin/messages" style="font-weight: bold; color: #2e7d32;">Enviar/Ver Mensagens</a>
    </div>
    
    <div style="margin-bottom: 30px; padding: 15px; background: #ffebee; border: 1px solid #ffcdd2; border-radius: 4px;">
        üìä **Resultados do Quiz:** <a href="/admin/quiz-submissions" style="font-weight: bold; color: #c62828;">Ver Submiss√µes dos Alunos</a>
    </div>
    
    <div style="background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <h3>Adicionar Nova Aula</h3>
        <form action="/admin/lessons" method="POST" enctype="multipart/form-data"> 
            
            <label for="title">T√≠tulo:</label>
            <input type="text" id="title" name="title" required>

            <label for="description">Descri√ß√£o:</label>
            <textarea id="description" name="description" rows="3"></textarea>

            <label for="module">M√≥dulo:</label>
            <select id="module" name="module" required>
                <option value="M√≥dulo 1">M√≥dulo 1</option>
                <option value="M√≥dulo 2">M√≥dulo 2</option>
                <option value="M√≥dulo 3">M√≥dulo 3</option>
            </select>

            <label for="content_file">Arquivo da Aula (.txt):</label>
            <input type="file" id="content_file" name="content_file" accept=".txt" required><br>

            <label for="release_date">Data de Libera√ß√£o:</label>
            <input type="date" id="release_date" name="release_date"><br>

            <button type="submit">Salvar Nova Aula</button>
        </form>
    
        <small style="display: block; margin-top: 10px; color: #777;">
            O arquivo TXT ser√° enviado automaticamente para a pasta <code>content/</code>.
        </small>
    </div>
    <small style="display: block; margin-top: 10px; color: #777;">
        O arquivo TXT ser√° enviado automaticamente para o **Firebase Storage**.
    </small>
</div>

<h3>Aulas Existentes</h3>
<% if (lessons.length > 0) { %>
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px; background: #fff;">
        <thead>
            <tr style="background-color: #ecf0f1;">
                <th style="padding: 10px; text-align: left;">T√≠tulo</th>
                <th style="padding: 10px; text-align: left;">M√≥dulo</th>
                <th style="padding: 10px; text-align: left;">Arquivo Storage</th>
                <th style="padding: 10px; text-align: left;">A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            <% lessons.forEach(lesson => { %>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;"><%= lesson.title %></td>
                    <td style="padding: 10px;"><%= lesson.module %></td>
                    <td style="padding: 10px;">
                         <a href="/admin/lessons/<%= lesson.id %>">
                            <code><%= lesson.content_file %>.txt</code>
                         </a>
                    </td>
                     <td style="padding: 10px;">
                        <form action="/admin/lessons/<%= lesson.id %>/delete" method="POST" onsubmit="return confirm('Tem certeza que deseja apagar a aula: <%= lesson.title %>?');">
                            <input type="hidden" name="firestoreId" value="<%= lesson.id %>">
                            <input type="hidden" name="fileName" value="<%= lesson.content_file %>">
                            <button type="submit" style="background: #e57373; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">Apagar</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>
<% } else { %>
    <p>Nenhuma aula cadastrada ainda.</p>
<% } %>
</div>

