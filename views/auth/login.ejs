<% layout = "layout" %>
<div class="container" style="max-width: 400px; padding-top: 50px;">
    
    <% 
        // ğŸš¨ NOVO: Se o usuÃ¡rio jÃ¡ estiver logado (user estÃ¡ preenchido), redireciona.
        if (typeof user !== 'undefined' && user) {
            res.redirect('/lessons');
            return; // Impede a renderizaÃ§Ã£o do formulÃ¡rio
        }
    %>

    <h2>Login de Alunos</h2>

        <% if (error) { %>
        <p style="color: red; padding: 10px; background: #fdd; border: 1px solid red; border-radius: 4px;">
            <%= error %>
            
            [span_0](start_span)<% // Se o erro for sobre a pendÃªncia, exibe o link do WhatsApp[span_0](end_span) %>
            [span_1](start_span)<% if (error.includes('pendente de aprovaÃ§Ã£o')) { %>[span_1](end_span)
                <br><br>
                [span_2](start_span)<a href="https://wa.me/244955585363?text=Ol%C3%A1%2C%20acabei%20de%20me%20cadastrar%20no%20curso%20e%20gostaria%20de%20solicitar%20o%20acesso%20%C3%A0s%20aulas."[span_2](end_span)
                [span_3](start_span)target="_blank" style="display: block; text-align: center; margin-top: 10px; background-color: #25d366; color: white; padding: 10px; border-radius: 4px; text-decoration: none;">[span_3](end_span)
                    [span_4](start_span)PeÃ§a o seu acesso pelo WhatsApp[span_4](end_span)
                </a>
            <% } %>
        </p>
    <% } %>


    <% if (success === 'true') { %>
        [span_5](start_span)<p style="color: green; padding: 10px; background: #ddf; border: 1px solid green; border-radius: 4px;">[span_5](end_span)
            [span_6](start_span)Cadastro realizado com sucesso[span_6](end_span)!
            [span_7](start_span)FaÃ§a login para comeÃ§ar.[span_7](end_span)
        </p>
    <% } %>

    <form action="/auth/login" method="POST">
        
        <label for="username">UsuÃ¡rio:</label>
        <input type="text" id="username" name="username" required><br>

        <label for="password">Senha:</label>
        <input type="password" id="password" name="password" required><br>

        <button type="submit">Entrar</button>
    </form>

    <p style="text-align: center; margin-top: 20px;">
        NÃ£o tem conta?
        [span_8](start_span)<a href="/auth/register">Cadastre-se</a>[span_8](end_span)
    </p>
</div>
</div>

