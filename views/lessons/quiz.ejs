<% layout = "layout" %>
<div class="container">
  <h2>Quiz da Aula <%= lessonId %></h2>

  <p><a href="/lessons/<%= lessonId %>">‚Üê Voltar para a Aula</a></p>

  <% // üí° CORRE√á√ÉO AQUI: Verifica se 'quiz' e 'quiz.questions' existem %>
  <% if (quiz && quiz.questions && Object.keys(quiz.questions).length > 0) { %>

    <form method="POST" action="/lessons/<%= lessonId %>/quiz"> 
      <% // Itera sobre as chaves (qKey, ex: 'q1') do objeto quiz.questions %>
      <% Object.keys(quiz.questions).forEach(function(qKey, index) { 
           const q = quiz.questions[qKey]; %>
        <div style="margin-bottom:20px;">
          <% // qKey √© usado como o 'name' do input, o que o servidor espera. %>
          <p><b><%= index + 1 %>. <%= q.text %></b></p>
          <% q.options.forEach(function(opt, idx) { %>
            <label>
              <% // O 'value' √© o √≠ndice (idx) da resposta. %>
              <input type="radio" name="<%= qKey %>" value="<%= idx %>" required>
              <%= opt %>
            </label><br>
          <% }); %>
        </div>
      <% }); %>
      <button type="submit" style="background-color: #00bcd4; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
        Enviar Respostas
      </button>
    </form>

  <% } else { %>
    <div style="padding: 15px; margin-bottom: 20px; border: 1px solid #ffcc00; background-color: #fffde7; color: #ff9800; border-radius: 4px;">
        <strong>Erro:</strong> N√£o h√° perguntas de quiz configuradas para esta aula.
    </div>
  <% } %>
</div>

